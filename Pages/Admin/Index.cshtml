@page
@model GoldContest.Pages.Admin.AdminIndexModel
@{
    ViewData["Title"] = "Admin Dashboard";
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Admin Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            padding: 30px;
        }

        h1 {
            color: #1e88e5;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gold-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        input {
            padding: 8px;
            width: 200px;
        }

        button {
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            background: #1e88e5;
            color: white;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #1e88e5;
            color: white;
        }
    </style>
</head>

<body>

<div class="top-bar">
    <h1>Admin Dashboard</h1>

    <form method="get" action="/Admin/Logout">
        <button style="background:#e53935;">Logout</button>
    </form>
</div>

<!-- ================= SEARCH WINNER ================= -->
<form method="post"
      asp-page="/Admin/Index"
      asp-page-handler="SearchWinner">
    @Html.AntiForgeryToken()

    <div class="gold-box">
        <strong>Actual Gold Price:</strong>

        <!-- ðŸ”¥ asp-for IS MANDATORY -->
        <input type="number"
               step="0.01"
               asp-for="ActualGoldPrice"
               required />

        <button type="submit">Search Winner</button>
        <a href="/Admin/Index" style="margin-left:8px; padding: 10px 14px; background: #757575; color: white; text-decoration: none; border-radius: 6px;">Reset</a>
    </div>
</form>

<!-- ================= ENTRIES TABLE ================= -->
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Account Number</th>
            <th>Account Name</th>
            <th>Lower Rate</th>
            <th>Upper Rate</th>
            <th>Action</th>
        </tr>
    </thead>

    <tbody>
    @if (!Model.Entries.Any())
    {
        <tr>
            <td colspan="6" style="text-align:center;">
                No matching records found
            </td>
        </tr>
    }
    else
    {
        foreach (var entry in Model.Entries)
        {
            <tr>
                <td>@entry.Id</td>
                <td>@entry.AccountNumber</td>
                <td>@entry.AccountName</td>
                <td>@entry.LowerRate</td>
                <td>@entry.UpperRate</td>
                <td>
                    <!-- ðŸ”¥ THIS FORM IS THE CRITICAL FIX -->
                    <form method="post"
                          asp-page="/Admin/Index"
                          asp-page-handler="SetWinner">
                        @Html.AntiForgeryToken()

                        <!-- ðŸ”¥ MUST BE name="id" -->
                        <input type="hidden" name="id" value="@entry.Id" />

                        <button type="submit">
                            Set as Winner
                        </button>
                    </form>
                </td>
            </tr>
        }
    }
    </tbody>
</table>

</body>
</html>